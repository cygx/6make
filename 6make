#!/usr/bin/env perl6

my $*SIXMAKE-DIR = $?FILE.IO.parent.abspath;
my $ECOSYSTEM :=
    'https://raw.githubusercontent.com/perl6/ecosystem/master/META.list';

my $batching = False;

proto MAIN(|) {
    {*}

    if $batching {
        my &get := EVALFILE "{$?FILE}-get.plugin";
        @*ARGS.append(get(@*ARGS.pop).lines);
    }

    my $cmd = @*ARGS.shift;
    EVALFILE "{$?FILE}-$cmd";
}

multi MAIN('scan') {}
multi MAIN('add', *@METAINFO) {}

multi MAIN('add', $LIST, Bool :$batch!) {
    $batching = True;
    @*ARGS.shift;
}

multi MAIN('ecosync') {
    $batching = True;
    @*ARGS = 'add', $ECOSYSTEM;
}
